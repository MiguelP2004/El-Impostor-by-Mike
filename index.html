<!doctype html>
<html lang="es">
<head>
  <title>El Impostor</title>
  <meta name="apple-mobile-web-app-title" content="Impostor by Mike">
  <link rel="apple-touch-icon" sizes="180x180" href="indiBola.png">


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  
  <meta name="description" content="Juego del impostor creado por Mike">

  <!-- PWA & icons: usa rutas relativas (sin / inicial) -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS home screen icon -->
  <link rel="apple-touch-icon" href="indiBola.png">
  <link rel="apple-touch-icon" sizes="180x180" href="indiBola.png">

  <!-- General icons (PWA / Android) -->
  <link rel="icon" type="image/png" sizes="192x192" href="indiBola.png">
  <link rel="icon" type="image/png" sizes="512x512" href="indiBola.png">
  <link rel="icon" href="indiBola.png">

  <meta name="theme-color" content="#ffc107">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Impostor by Mike">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#1a1a2e;
      --bg2:#16213e;
      --accent:#ffc107;
      --accent2:#ffeb3b;
      --card:#2a2d3a;
      --card-light:#353847;
      --muted:#d0d3e1;
      --text:#f0f1f5;
      --round:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #1a1635;
      min-height:100vh;
      min-height:-webkit-fill-available;
      display:flex;
      align-items:center;
      justify-content:center;
      /* el scroll se hace en el body, los c√≠rculos son fixed y no se mueven */
      overflow-x:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      touch-action: pan-y;
    }
    
    html {
      touch-action: manipulation;
      height:100%;
    }
    
    input, button, select, textarea {
      touch-action: manipulation;
    }
    
    /* Animated background circles */
    .bg-circle{
      position:fixed;          /* ya fija los c√≠rculos al viewport */
      border-radius:50%;
      background:rgba(255,255,255,0.03);
      pointer-events:none;
      z-index:0;
    }
    
    @keyframes floatCircle1 {
      0% { transform:translate(0, 0) scale(1); opacity:0; }
      10% { opacity:1; }
      90% { opacity:1; }
      100% { transform:translate(100vw, -100vh) scale(1.5); opacity:0; }
    }
    
    @keyframes floatCircle2 {
      0% { transform:translate(0, 0) scale(1); opacity:0; }
      10% { opacity:1; }
      90% { opacity:1; }
      100% { transform:translate(-100vw, 100vh) scale(1.2); opacity:0; }
    }
    
    @keyframes floatCircle3 {
      0% { transform:translate(0, 0) scale(1); opacity:0; }
      10% { opacity:1; }
      90% { opacity:1; }
      100% { transform:translate(80vw, 90vh) scale(1.3); opacity:0; }
    }
    
    .container{
      width:100%;
      max-width:550px;
      background:linear-gradient(180deg, rgba(42,45,58,0.98), rgba(35,38,48,0.95));
      border-radius:24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      padding:22px;
      animation: float 6s ease-in-out infinite;
      position:relative;
      z-index:1;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }
    
    header{display:flex;gap:12px;align-items:center;margin-bottom:12px;justify-content:center;text-align:center;flex-direction:row}
    .dog-logo{
      width:70px;
      height:70px;
      border-radius:50%;
      object-fit:cover;
      border:4px solid #ffc107;
      box-shadow:0 6px 18px rgba(255,193,7,0.4);
    }
    
    @keyframes wobble {
      0%, 100% { transform:rotate(-3deg); }
      50% { transform:rotate(3deg); }
    }
    
    h1{font-family:'Fredoka One',cursive;margin:0;font-size:20px;text-align:center;color:#ffc107;text-shadow:0 2px 8px rgba(255,193,7,0.3)}
    p.lead{margin:0;color:#d0d3e1;text-align:center}
    .title-wrapper{display:flex;flex-direction:column;align-items:flex-start}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    label{display:block;font-size:13px;color:#f0f1f5;margin-bottom:6px;text-align:center;font-weight:600}
    input[type=number], input[type=text], select{width:100%;padding:10px;border-radius:12px;border:1px solid rgba(255,193,7,0.3);background:var(--card-light);color:var(--text);font-size:16px;transition:all 0.3s ease;touch-action:manipulation}
    input[type=text]:focus{outline:none;border-color:#ffc107;box-shadow:0 0 0 3px rgba(255,193,7,0.25);transform:scale(1.02)}
    input[type=text]::placeholder{color:#9a9dad;font-weight:400}
    
    /* Name input styling */
    .name-input-wrapper{position:relative;margin-bottom:8px}
    .name-input-wrapper input{font-weight:500}
    
    /* Inputs de nombre con estilo de juego */
    .name-input {
      font-family:'Fredoka One',cursive;
      font-size:18px;
      letter-spacing:0.5px;
      text-transform:none;
    }
    
    /* Counter buttons */
    .counter{display:flex;align-items:center;justify-content:center;gap:12px;margin-top:4px}
    .counter-btn{width:40px;height:40px;border-radius:50%;background:linear-gradient(180deg,#ffc107,#ffb300);color:#3e2723;font-weight:700;border:none;cursor:pointer;font-size:20px;display:flex;align-items:center;justify-content:center;box-shadow:0 3px 10px rgba(255,193,7,0.4);transition:all 0.2s ease}
    .counter-btn:hover{transform:scale(1.1);box-shadow:0 5px 16px rgba(255,193,7,0.6)}
    .counter-btn:active{transform:scale(0.95);box-shadow:0 2px 6px rgba(255,193,7,0.5)}
    .counter-value{font-size:28px;font-weight:700;color:#ffc107;min-width:50px;text-align:center;text-shadow:0 2px 4px rgba(255,193,7,0.2)}
    
    .btn{display:inline-block;padding:12px 16px;border-radius:14px;background:linear-gradient(180deg,#ffc107,#ffb300);color:#3e2723;font-weight:700;text-align:center;border:none;cursor:pointer;box-shadow:0 6px 16px rgba(255,193,7,0.4);transition:all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55)}
    .btn:hover{transform:translateY(-4px) scale(1.05);box-shadow:0 10px 24px rgba(255,193,7,0.6)}
    .btn:active{transform:translateY(-2px) scale(1.02);box-shadow:0 5px 12px rgba(255,193,7,0.5)}
    .btn.big{padding:16px 32px;font-size:20px;font-family:'Fredoka One',cursive}
    .btn.medium{padding:14px 24px;font-size:18px;font-family:'Fredoka One',cursive}
    .btn.secondary{background:linear-gradient(180deg,#ffeb3b,#fff59d);color:#3e2723;box-shadow:0 6px 16px rgba(255,235,59,0.35)}
    .btn.secondary:hover{box-shadow:0 10px 24px rgba(255,235,59,0.5)}
    .btn.secondary:active{box-shadow:0 5px 12px rgba(255,235,59,0.4)}
    .center{text-align:center}

    .card{background:linear-gradient(180deg,rgba(42,45,58,0.95),rgba(35,38,48,0.92));border-radius:18px;padding:18px;box-shadow:0 8px 20px rgba(12,20,40,0.4);text-align:center;border:1px solid rgba(255,193,7,0.2)}

    /* Role card */
    .role-card{min-height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:16px;padding:20px}
    .player-indicator{font-size:24px;color:#ffc107;font-weight:700;margin-bottom:4px;text-shadow:0 2px 6px rgba(255,193,7,0.4);font-family:'Fredoka One',cursive}
    .player-number{font-size:14px;color:#d0d3e1;font-weight:600;margin-bottom:12px}
    .word{font-family:'Fredoka One',cursive;font-size:48px;color:#4fd1c5;margin-top:16px;animation:popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);text-shadow:0 4px 12px rgba(79,209,197,0.6)}
    .impostor-badge{font-family:'Fredoka One',cursive;color:white;background:#ff3b3b;padding:10px 14px;border-radius:999px;font-size:20px;animation:shake 0.5s ease-in-out;box-shadow:0 4px 12px rgba(255,59,59,0.5)}
    .civil-badge{font-family:'Fredoka One',cursive;color:white;background:#4fd1c5;padding:10px 14px;border-radius:999px;font-size:20px;animation:popIn 0.5s ease-in-out;box-shadow:0 4px 12px rgba(79,209,197,0.5)}
    
    @keyframes popIn {
      0% { transform:scale(0); opacity:0; }
      50% { transform:scale(1.1); }
      100% { transform:scale(1); opacity:1; }
    }
    
    @keyframes shake {
      0%, 100% { transform:translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform:translateX(-5px); }
      20%, 40%, 60%, 80% { transform:translateX(5px); }
    }
    
    @keyframes slideIn {
      from { transform:translateY(20px); opacity:0; }
      to { transform:translateY(0); opacity:1; }
    }
    
    .role-card > * {
      animation:slideIn 0.3s ease-out forwards;
    }
    
    .role-card > *:nth-child(2) {
      animation-delay:0.1s;
      opacity:0;
    }

    /* Voting list */
    .players-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-top:10px}
    .player-pill{padding:12px;border-radius:12px;background:linear-gradient(180deg,var(--card-light),var(--card));color:#f0f1f5;text-align:center;border:1px solid rgba(255,193,7,0.2);cursor:pointer;transition:all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);font-weight:600;position:relative;overflow:hidden}
    .player-pill::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,193,7,0.2);transition:width 0.3s ease, height 0.3s ease;transform:translate(-50%,-50%)}
    .player-pill:hover{border-color:rgba(255,193,7,0.6);transform:translateY(-4px) scale(1.05);box-shadow:0 6px 18px rgba(255,193,7,0.3)}
    .player-pill:hover::before{width:200%;height:200%}
    .player-pill.selected{outline:4px solid rgba(255,193,7,0.7);background:linear-gradient(180deg,rgba(255,193,7,0.3),rgba(255,193,7,0.2));border-color:#ffc107;transform:translateY(-2px) scale(1.03);box-shadow:0 8px 20px rgba(255,193,7,0.4)}
    .muted{color:#d0d3e1}
    .impostor-reveal{display:inline-block;background:linear-gradient(135deg,#ff3b3b,#ff6b6b);color:#2a2d3a;padding:8px 16px;border-radius:999px;font-family:'Fredoka One',cursive;font-size:16px;margin-top:8px;margin-left:4px;margin-right:4px;box-shadow:0 4px 12px rgba(255,59,59,0.4);animation:popIn 0.5s ease-out}
    
    /* Countdown timer */
    .countdown-screen{
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:rgba(0,0,0,0.95);
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .countdown-number{
      font-family:'Fredoka One',cursive;
      font-size:80px;
      color:#ffc107;
      text-shadow:0 10px 40px rgba(255,193,7,0.8);
      animation:countdownPulse 1s ease-out;
    }
    @keyframes countdownPulse {
      0% { transform:scale(0); opacity:0; }
      50% { transform:scale(1.2); }
      100% { transform:scale(1); opacity:1; }
    }
    
    .first-speaker{
      font-size:22px;
      color:#4fd1c5;
      font-weight:700;
      margin-bottom:16px;
      text-shadow:0 3px 10px rgba(79,209,197,0.6);
      font-family:'Fredoka One',cursive;
      animation:popIn 0.6s ease-out;
    }
    
    footer{
      margin-top:14px;
      display:flex;
      gap:8px;
      justify-content:center;
      color:#a0a3b5;
      text-align:center;
      font-weight:700;
    }

    @media(max-width:720px){
      .grid{grid-template-columns:1fr}
      header{flex-direction:column}
      .title-wrapper{align-items:center}
      .countdown-number{font-size:60px}
      .intro-title{font-size:30px}
      .intro-logo{width:115px;height:115px}
    }

    /* Ajuste extra para iPhone / m√≥viles estrechos:
       deja un poco de hueco lateral a la interfaz */
    @media (max-width: 420px) {
      .container{
        width: calc(100% - 32px); /* 16px de margen a cada lado */
        max-width: 420px;
        margin: 0 auto;
        padding-inline: 16px;     /* un poco menos de padding horizontal */
      }
    }

    .intro-screen{
      position:fixed;
      inset:0;
      background:radial-gradient(circle at top, #2d1b4e 0, #1a1635 45%, #05020a 100%);
      z-index:10000;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:18px;
      /* nuevo: contenedor interno centrado y limitado al ancho de la carta */
    }
    /* capa de oscuridad con ‚Äúagujero‚Äù centrado m√°s peque√±o */
    .intro-screen::before{
      content:'';
      position:fixed;
      inset:0;
      pointer-events:none;
      /* c√≠rculo claro m√°s peque√±o centrado sobre la interfaz */
      background:
        radial-gradient(
          circle at 50% 50%,
          rgba(0,0,0,0) 0,
          rgba(0,0,0,0) 130px,
          rgba(0,0,0,0.95) 220px,
          rgba(0,0,0,0.98) 100%
        );
      z-index:-1;
    }
    .intro-logo{
      width:140px;
      height:140px;
      border-radius:50%;
      border:5px solid #ffc107;
      box-shadow:0 0 40px rgba(255,193,7,0.7);
      object-fit:cover;
      opacity:0;
      transform:scale(0.6);
      animation:introZoomSoft 0.9s ease-out forwards;
    }
    .intro-title{
      font-family:'Fredoka One',cursive;
      font-size:40px;
      letter-spacing:2px;
      color:#ffc107;
      text-shadow:0 4px 16px rgba(0,0,0,0.9);
      opacity:0;
      transform:translateY(10px);
      animation:introFadeUp 0.7s ease-out 0.25s forwards;
    }
    .intro-subtitle{
      font-size:16px;
      color:#4fd1c5;
      font-weight:600;
      opacity:0;
      transform:translateY(10px);
      animation:introFadeUp 0.7s ease-out 0.55s forwards;
    }
    .intro-glow{
      position:absolute;
      /* c√≠rculo m√°s peque√±o y bien centrado */
      width:180px;
      height:180px;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      border-radius:50%;
      background:radial-gradient(circle, rgba(255,193,7,0.25), transparent 60%);
      filter:blur(6px);
      opacity:0;
      animation:introGlow 0.9s ease-out forwards;
    }
    @keyframes introZoomSoft{
      from{opacity:0;transform:scale(0.6);}
      to{opacity:1;transform:scale(1);}
    }
    @keyframes introFadeUp{
      from{opacity:0;transform:translateY(10px);}
      to{opacity:1;transform:translateY(0);}
    }
    @keyframes introGlow{
      from{opacity:0;transform:translate(-50%,-50%) scale(0.6);}
      to{opacity:1;transform:translate(-50%,-50%) scale(1);}
    }
    .intro-screen.fade-out{
      animation:introFadeOut 0.4s ease-out forwards;
    }
    @keyframes introFadeOut{
      to{opacity:0;visibility:hidden;}
    }
  </style>
</head>
<body>
  <!-- INTRO -->
  <div class="intro-screen" id="introScreen">
    <div class="intro-glow"></div>
    <img src="indiBola.png" alt="Logo" class="intro-logo">
    <div class="intro-title">EL IMPOSTOR</div>
    <div class="intro-subtitle">creado por Mike</div>
  </div>

  <div class="container" id="mainContainer" style="opacity:0">
    <header>
      <img src="indiBola.png" alt="Logo" class="dog-logo">
      <div class="title-wrapper">
        <h1>El Impostor</h1>
        <p class="lead">creado por Mike</p>
      </div>
    </header>

    <main id="app">
      <!-- SETUP SCREEN -->
      <section id="setup" class="card">
        <div class="grid">
          <div>
            <label>Jugadores</label>
            <div class="counter">
              <button class="counter-btn" id="decPlayers">‚àí</button>
              <div class="counter-value" id="playersDisplay">4</div>
              <button class="counter-btn" id="incPlayers">+</button>
            </div>
          </div>
          <div>
            <label>Impostores</label>
            <div class="counter">
              <button class="counter-btn" id="decImpostors">‚àí</button>
              <div class="counter-value" id="impostorsDisplay">1</div>
              <button class="counter-btn" id="incImpostors">+</button>
            </div>
          </div>
        </div>
        <div style="margin-top:12px" class="center">
          <button class="btn big" id="continueBtn">Continuar</button>
        </div>
      </section>

      <!-- NAMES SCREEN -->
      <section id="names" class="card" style="display:none;margin-top:12px">
        <div class="center">
          <p style="font-family:'Fredoka One',cursive;font-size:18px;color:#ffc107;margin-bottom:16px;text-shadow:0 2px 6px rgba(255,193,7,0.3)">Nombres de Jugadores</p>
          <div id="namesList" style="display:grid;gap:10px;margin-bottom:16px"></div>
          <button class="btn big" id="startBtn">Empezar partida</button>
        </div>
      </section>

      <!-- PASS & REVEAL SCREEN -->
      <section id="pass" class="card" style="display:none;margin-top:12px">
        <div class="center">
          <div class="player-indicator" id="playerIndicator">Mike</div>
          <div class="player-number" id="playerNumber">Jugador 2 de 4</div>
          <div style="height:8px"></div>
          <button class="btn big secondary" id="revealBtn">üîç Ver mi rol</button>
        </div>
        <div style="height:12px"></div>
        <div id="roleArea" style="display:none;" class="role-card">
          <!-- role revealed content injected here -->
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
          <button class="btn medium" id="nextBtn" style="display:none">Siguiente</button>
        </div>
      </section>

      <!-- DISCUSSION / VOTING -->
      <section id="discussion" class="card" style="display:none;margin-top:12px">
        <div class="center">
          <div class="first-speaker" id="firstSpeakerName" style="display:none"></div>
          <p class="muted">Hablad entre vosotros y decidid a qui√©n votar!!</p>
          <div style="height:8px"></div>
          <p class="muted" style="font-weight:700">Selecciona al jugador que quer√©is expulsar:</p>
          <div class="players-list" id="discussionVoteList" style="margin-top:10px"></div>
          <div style="height:12px"></div>
          <button class="btn big" id="submitGroupVoteBtn">Confirmar votaci√≥n</button>
        </div>
      </section>

      <!-- RESULTS -->
      <section id="results" class="card" style="display:none;margin-top:12px">
        <div id="resultText" class="center"></div>
        <div style="height:12px"></div>
        <div id="impostorsReveal" class="center muted" style="font-weight:700"></div>
        <div style="height:12px"></div>
        <div class="center" id="newGameContainer">
          <button class="btn big secondary" id="newGame">Reiniciar partida</button>
        </div>
      </section>

    </main>

    <footer style="margin-top:12px">He hecho este juego porque me aburr√≠a la verdad...</footer>
  </div>

  <script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js').then(function(registration) {
          console
          console.log('ServiceWorker registrado con √©xito:', registration.scope);
        }, function(err) {
          console.log('ServiceWorker registro fallido:', err);
        });
      });
    }

    // --- C√çRCULOS DE FONDO ANIMADOS ---
    function createBackgroundCircle() {
      const circle = document.createElement('div');
      circle.className = 'bg-circle';
      
      const size = Math.random() * 220 + 100;       // un poco m√°s peque√±os: 100‚Äì320 px
      circle.style.width = size + 'px';
      circle.style.height = size + 'px';
      
      // Posici√≥n m√°s cerca del centro de la pantalla
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const centerX = vw * 0.5;
      const centerY = vh * 0.5;
      const offsetX = (Math.random() - 0.5) * vw * 0.6;  // rango m√°s estrecho
      const offsetY = (Math.random() - 0.5) * vh * 0.6;
      const startX = centerX + offsetX;
      const startY = centerY + offsetY;
      circle.style.left = startX + 'px';
      circle.style.top = startY + 'px';
      
      const animations = ['floatCircle1', 'floatCircle2', 'floatCircle3'];
      const randomAnim = animations[Math.floor(Math.random() * animations.length)];
      const duration = Math.random() * 14 + 14;     // algo m√°s r√°pidas: 14‚Äì28 s
      
      circle.style.animation = `${randomAnim} ${duration}s linear forwards`;
      
      document.body.appendChild(circle);
      
      setTimeout(() => {
        circle.remove();
      }, duration * 1000);
    }

    // Crear algunos c√≠rculos iniciales
    for (let i = 0; i < 6; i++) {
      setTimeout(() => createBackgroundCircle(), i * 1200);
    }

    // M√°s frecuencia: cada 4s en vez de 6s
    setInterval(() => {
      createBackgroundCircle();
    }, 4000);
    // --- FIN C√çRCULOS DE FONDO ---

    // --- AUDIO UNLOCK PATCH ---
    let sharedAudioCtx = null;
    let audioUnlocked = false;

    function createSharedAudioContext(){
      if(!sharedAudioCtx){
        sharedAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      return sharedAudioCtx;
    }

    async function unlockAudioWithUserGesture(){
      try {
        const ctx = createSharedAudioContext();
        if(ctx.state === 'suspended') await ctx.resume();
        const buffer = ctx.createBuffer(1, 1, 22050);
        const src = ctx.createBufferSource();
        src.buffer = buffer;
        src.connect(ctx.destination);
        src.start(0);
        audioUnlocked = true;
        return true;
      } catch (err) {
        console.warn('No se pudo desbloquear audio:', err);
        return false;
      }
    }

    // √öNICA funci√≥n playSound (la buena, compartida)
    function playSound(frequency, duration, volume = 0.3) {
      try {
        const ctx = createSharedAudioContext();
        if(ctx.state === 'suspended'){
          return; // se reanudar√° en unlockAudioWithUserGesture
        }
        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);
        oscillator.frequency.value = frequency;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(volume, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + Math.max(0.01, duration));
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + duration + 0.01);
      } catch (e) {
        // silencioso
      }
    }

    function playPopSound(){ playSound(800, 0.08, 0.22); }
    function playClickSound(){ playSound(400, 0.05, 0.15); }
    function playSuccessSound(){ 
      playSound(600, 0.06, 0.12); 
      setTimeout(()=>playSound(900,0.07,0.14),60); 
    }
    function playStartGameSound() {
      playSound(500, 0.1, 0.2);
      setTimeout(() => playSound(700, 0.1, 0.2), 80);
      setTimeout(() => playSound(900, 0.1, 0.22), 160);
      setTimeout(() => playSound(1200, 0.15, 0.25), 240);
    }
    // Antes: aqu√≠ sonaba el jingle inicial; ahora lo dejamos vac√≠o
    function playIntroSound() {
      // Sin sonido en la intro inicial
    }
    // --- FIN PATCH ---

    // --- Datos y estado ---
    const continueBtn = document.getElementById('continueBtn');
    const startBtn = document.getElementById('startBtn');
    const setup = document.getElementById('setup');
    const namesSection = document.getElementById('names');
    const namesList = document.getElementById('namesList');
    const pass = document.getElementById('pass');
    const revealBtn = document.getElementById('revealBtn');
    const roleArea = document.getElementById('roleArea');
    const nextBtn = document.getElementById('nextBtn');
    const playerIndicator = document.getElementById('playerIndicator');
    const playerNumber = document.getElementById('playerNumber');
    const discussion = document.getElementById('discussion');
    const discussionVoteList = document.getElementById('discussionVoteList');
    const submitGroupVoteBtn = document.getElementById('submitGroupVoteBtn');
    const results = document.getElementById('results');
    const resultText = document.getElementById('resultText');
    const impostorsReveal = document.getElementById('impostorsReveal');
    const newGame = document.getElementById('newGame');
    const newGameContainer = document.getElementById('newGameContainer');

    const defaultWords = [
      // Objetos comunes
      'manzana','gato','cohete','reloj','caf√©','cami√≥n','playa','libro','estrella','√°rbol','zapato','lobo','pelota','puerta','silla','mesa','l√°piz','tel√©fono','guitarra','piano','bicicleta','coche','avi√≥n','barco','paraguas','gafas','maleta','ordenador','teclado','c√°mara','micr√≥fono','auriculares','ventana','espejo','cuchillo','tenedor','cuchara','plato','vaso','botella','cepillo','toalla','almohada','manta','sof√°','l√°mpara','televisi√≥n',
      
      // Comidas y bebidas
      'pizza','hamburguesa','paella','tacos','pasta','arroz','pollo','pescado','carne','ensalada','sopa','pan','queso','huevo','chocolate','helado','galleta','pastel','donut','zumo','agua','leche','t√©','cerveza','vino','naranja','pl√°tano','fresa','sand√≠a','mel√≥n','uva','pi√±a','mango','aguacate','tomate','lechuga','zanahoria','patata','cebolla',
      
      // Deportistas reconocidos mundialmente
      'Lionel Messi','Cristiano Ronaldo','Rafael Nadal','LeBron James','Michael Jordan','Usain Bolt','Roger Federer','Serena Williams','Tiger Woods','Neymar Junior','Kylian Mbapp√©','Mohamed Salah','Robert Lewandowski',
      'Zinedine Zidane','Pel√©','Diego Maradona','Ronaldinho','Andr√©s Iniesta','Xavi Hern√°ndez','Sergio Ramos','Karim Benzema','Luka Modriƒá','Erling Haaland','Vin√≠cius J√∫nior','Gianluigi Buffon','Zlatan Ibrahimovic','Luis Su√°rez','Kevin De Bruyne','Harry Kane','Son Heung-min','Gareth Bale','Antoine Griezmann','Paulo Dybala','Thibaut Courtois',
      'Venus Williams','Carlos Alcaraz','Rafa M√°rquez','Jannik Sinner','John Cena','Conor McGregor','Ilia Topuria','Randy Orton',
      
      // Actores y actrices
      'Leonardo DiCaprio','Brad Pitt','Tom Cruise','Johnny Depp','Will Smith','Robert Downey Jr.','Dwayne Johnson','Chris Hemsworth','Scarlett Johansson','Jennifer Lawrence','Emma Watson','Natalie Portman','Angelina Jolie','Margot Robbie','Zendaya Coleman','Tom Holland','Timoth√©e Chalamet','Ana de Armas','Pedro Pascal','Javier Bardem','Pen√©lope Cruz','Antonio Banderas','Mel Gibson','Jack Nicholson','Julia Roberts','Chris Evans','Hugh Jackman','Chris Pratt','Adam Sandler','Kevin Hart','Chris Rock',
      'Jackie Chan','Keanu Reeves',
      
      // YouTubers y streamers
      'MrBeast','PewDiePie','ElRubius','AuronPlay','Ibai Llanos','El Xokas','TheGrefg','Vegetta777','Willyrex','DjMaRiiO','Luzu','Alexby11','Fernanfloo','JuegaGerman','Ninja',
      
      // Pa√≠ses y lugares
      'Espa√±a','Francia','Italia','Alemania','Inglaterra','Portugal','Brasil','Argentina','M√©xico','Colombia','Per√∫','Chile','Venezuela','Uruguay','Ecuador','Cuba','Jap√≥n','China','Corea','India','Australia','Canad√°','Estados Unidos','Rusia','Egipto','Marruecos','Grecia','Turqu√≠a','Tailandia','Vietnam','Noruega','Suecia','Dinamarca','Holanda','B√©lgica','Suiza','Austria','Polonia','Irlanda','Escocia',
      
      // Personajes hist√≥ricos
      'Albert Einstein','Isaac Newton','Leonardo da Vinci','Napole√≥n Bonaparte','Julio C√©sar','Cleopatra','Abraham Lincoln','Winston Churchill','Gandhi','Nelson Mandela','Martin Luther King','Marie Curie','Nikola Tesla','Steve Jobs','Bill Gates','Pablo Picasso','Vincent van Gogh','Mozart','Beethoven','Shakespeare','Cervantes','Crist√≥bal Col√≥n','Galileo Galilei','Charles Darwin','Adolf Hitler','Donald Trump','Barack Obama','George Washington','Javier Milei',
      
      // Trabajos y oficios
      'm√©dico','profesor','ingeniero','arquitecto','abogado','polic√≠a','bombero','cocinero','camarero','panadero','carpintero','electricista','fontanero','mec√°nico','piloto','conductor','taxista','cartero','jardinero','pintor','m√∫sico','cantante','bailar√≠n','actor','director','fot√≥grafo','periodista','escritor','cient√≠fico','astronauta','soldado','enfermero','veterinario','dentista','farmac√©utico','programador','dise√±ador',
      
      // Pel√≠culas y series famosas
      'Titanic','Avatar','Avengers','Star Wars','Harry Potter','El Padrino','Pulp Fiction','Los Goonies','Forrest Gump','Matrix','Gladiador','Inception','Interstellar','Breaking Bad','Game of Thrones','Stranger Things','La Casa de Papel','Friends','The Office','Narcos','Black Mirror','Squid Game','Wednesday','The Crown','Peaky Blinders','The Mandalorian','Better Call Saul','Cobra Kai','The Walking Dead','IT',
      'El Se√±or de los Anillos','Los Soprano','El resplandor','Alien','Terminator','El silencio de los corderos','Jurassic Park','La vida es bella','La lista de Schindler','1917','Joker','La La Land','Toy Story','Coco','Up','Django desencadenado','Kill Bill','El club de la Lucha','Memento','La Pasi√≥n de Cristo','El renacido','El √∫ltimo mohicano','Braveheart','Westworld','Dexter','Lost','Sherlock','True Detective','Chern√≥bil','The Wire','Black Panther','Guardianes de la Galaxia','Casablanca',
      
      // Animales
      'perro','elefante','le√≥n','tigre','oso','mono','jirafa','cebra','hipop√≥tamo','rinoceronte','cocodrilo','serpiente','√°guila','b√∫ho','pato','cisne','delf√≠n','ballena','tibur√≥n','pulpo','ping√ºino','koala','canguro','panda','tortuga','conejo','rat√≥n','ardilla','zorro','ciervo','caballo','vaca','cerdo','oveja','gallina','pavo',
      
      // Deportes y actividades
      'f√∫tbol','baloncesto','tenis','nataci√≥n','ciclismo','atletismo','boxeo','gimnasia','voleibol','rugby','hockey','b√©isbol','golf','esqu√≠','surf','escalada','yoga','baile','karate','judo','esgrima',
      
      // Tecnolog√≠a y marcas
      'iPhone','Samsung','PlayStation','Xbox','Nintendo','Tesla','Ferrari','Lamborghini','Porsche','Mercedes','BMW','Audi','Coca-Cola','Pepsi','McDonald\'s','Starbucks','Amazon','Google','Facebook','Instagram','Twitter','TikTok','YouTube','Netflix','Spotify','Apple','Microsoft',
      
      // Instrumentos musicales
      'bater√≠a','viol√≠n','flauta','trompeta','saxof√≥n','clarinete','ukelele',
      
      // Superh√©roes, personajes ficticios y dibujos animados
      'Superman','Batman','Spider-Man','Iron Man','Hulk','Thor','Capit√°n Am√©rica','Wonder Woman','Flash','Aquaman','Deadpool','Wolverine','Black Widow','Doctor Strange','Thanos','Harley Quinn','Loki','Venom','Mario Bros','Luigi','Sonic','Pikachu','Mickey Mouse','Donald Duck','Goofy','Bob Esponja','Patrick Estrella','Bugs Bunny','Pato Lucas','Tom y Jerry','Scooby-Doo','Shaggy','Homer Simpson','Bart Simpson','Lisa Simpson','Marge Simpson','Peter Griffin','Stewie Griffin','Rick Sanchez','Morty Smith','Ash Ketchum','Goku','Vegeta','Naruto','Luffy','Hermione Granger','Ron Weasley','Dumbledore','Voldemort','Gandalf','Frodo Bols√≥n','Aragorn','Legolas','Jon Nieve','Daenerys Targaryen','Tyrion Lannister','Eleven','Mike Wheeler','Dustin Henderson',
      'Neo Matrix','Rey','Kylo Ren','Luke Skywalker','Leia Organa','Han Solo','Obi-Wan Kenobi','Yoda','Sauron','Severus Snape','Draco Malfoy','Sirius Black','Cersei Lannister','Sansa Stark','Ned Stark','Brienne of Tarth','Captain Hook','Peter Pan','Mulan','Pocahontas','Hercules','Maui','Moana','WALL-E','Maleficent','Grogu','Steve Harrington','Walter White','Jesse Pinkman','Saul Goodman','Sherlock Holmes','Elsa','Anna','Olaf','Woody','Buzz Lightyear','Nemo','Dory','Shrek','Burro','Simba','Mufasa','Aladino','Jasmine','Genio','La bella y la bestia','Ariel','Cenicienta','Blancanieves','James Bond','Indiana Jones','Jack Sparrow',
      
      // Palabras extra
      'Madonna','Marilyn Monroe','Beyonc√©','Adele','Taylor Swift','Elvis Presley','The Beatles','Rolling Stones','Queen','Michael Jackson','Whitney Houston',
      'Shakira','Rihanna','Katy Perry','Billie Eilish','Drake','Eminem','Kanye West','Ariana Grande',
      'Coldplay','U2','Metallica','Bruno Mars','Ed Sheeran','Michael Myers','Freddy Krueger','Jason Voorhees','Jigsaw','Chucky','Darth Vader','Duende Verde','Anabelle','Godzilla','R2-D2','C-3PO','E.T.',
      'Par√≠s','Londres','Nueva York','Tokio','Roma','Barcelona','Mosc√∫','Berl√≠n','S√≠dney','Los √Ångeles',
      'Machu Picchu','Taj Mahal','Gran Ca√±√≥n','Monte Everest','Torre Eiffel','Estatua de la Libertad','Gran Muralla','Sagrada Familia',
      'Nike','Adidas','IKEA','LEGO','croissant','ramen','Bad Bunny','Ozuna','J Balvin','Karol G','Daddy Yankee','Luis Fonsi','Maluma','Anuel AA','Bizarrap','Sebasti√°n Yatra','Bachata',
      'FC Barcelona','Real Madrid','Manchester United','Liverpool','Bayern Munich','Juventus','PSG',
      'Marte','J√∫piter','Saturno','Mercurio','Venus','Urano','Neptuno','Plut√≥n','Sol','Luna',
      'Google Maps','El Principito','Moby Dick','Cien A√±os de Soledad','El Hobbit',
    ];


    let players = []; // {id, name, role: 'impostor'|'civil', word, eliminated: boolean}
    let numPlayers = 4;
    let numImpostors = 1;
    let savedPlayerNames = []; // Store player names for restart

    // Phase trackers
    let revealIndex = 0; // player currently checking role

    function randInt(max){return Math.floor(Math.random()*max)}

    // Calculate max impostors based on number of players
    function getMaxImpostors(numPlayers) {
      if(numPlayers <= 4) return 1;
      if(numPlayers <= 6) return 2;
      if(numPlayers === 7) return 3;
      if(numPlayers === 8) return 4;
      return 5; // for 9-10 players
    }

    // Sound effects
    let audioContext = null;

    function initAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      // Resume context if suspended (iOS requirement)
      if (audioContext.state === 'suspended') {
        audioContext.resume();
      }
      return audioContext;
    }

    function playSound(frequency, duration, volume = 0.3) {
      try {
        const ctx = initAudioContext();
        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);
        
        oscillator.frequency.value = frequency;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(volume, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
        
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + duration);
      } catch (err) {
        console.log('Audio error:', err);
      }
    }

    function playPopSound() {
      playSound(800, 0.1, 0.2);
    }

    function playSuccessSound() {
      playSound(600, 0.08, 0.15);
      setTimeout(() => playSound(800, 0.08, 0.15), 50);
      setTimeout(() => playSound(1000, 0.1, 0.2), 100);
    }

    function playClickSound() {
      playSound(400, 0.05, 0.15);
    }

    function playStartGameSound() {
      playSound(500, 0.1, 0.2);
      setTimeout(() => playSound(700, 0.1, 0.2), 80);
      setTimeout(() => playSound(900, 0.1, 0.22), 160);
      setTimeout(() => playSound(1200, 0.15, 0.25), 240);
    }

    // Counter controls
    decPlayers.addEventListener('click', () => {
      if(numPlayers > 3) {
        playClickSound();
        numPlayers--;
        playersDisplay.textContent = numPlayers;
        const maxImpostors = getMaxImpostors(numPlayers);
        if(numImpostors > maxImpostors) {
          numImpostors = maxImpostors;
          impostorsDisplay.textContent = numImpostors;
        }
      }
    });

    incPlayers.addEventListener('click', () => {
      if(numPlayers < 10) {
        playPopSound();
        numPlayers++;
        playersDisplay.textContent = numPlayers;
      }
    });

    decImpostors.addEventListener('click', () => {
      if(numImpostors > 1) {
        playClickSound();
        numImpostors--;
        impostorsDisplay.textContent = numImpostors;
      }
    });

    incImpostors.addEventListener('click', () => {
      const maxImpostors = getMaxImpostors(numPlayers);
      if(numImpostors < maxImpostors) {
        playPopSound();
        numImpostors++;
        impostorsDisplay.textContent = numImpostors;
      }
    });

    function showNamesScreen(){
      // Build initial players
      players = [];
      for(let i=0;i<numPlayers;i++){
        players.push({id:i, name:`Jugador ${i+1}`, role:'civil', word:null});
      }

      // Build names inputs
      namesList.innerHTML = '';
      
      players.forEach((p, idx) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'name-input-wrapper';
        wrapper.style.animation = `slideIn 0.3s ease-out ${idx * 0.05}s forwards`;
        wrapper.style.opacity = '0';
        
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = `Jugador ${idx+1}`;
        input.value = savedPlayerNames[idx] || '';
        input.dataset.playerId = p.id;
        // aplicar estilo de juego
        input.className = 'name-input';
        
        wrapper.appendChild(input);
        namesList.appendChild(wrapper);
      });

      setup.style.display = 'none';
      namesSection.style.display = 'block';
    }

    function startGame(){
      // Update player names from inputs and save them
      savedPlayerNames = [];
      Array.from(namesList.children).forEach(wrapper => {
        const input = wrapper.querySelector('input');
        const id = parseInt(input.dataset.playerId);
        const name = input.value.trim() || `Jugador ${id+1}`;
        players[id].name = name;
        players[id].eliminated = false;
        savedPlayerNames[id] = input.value.trim();
      });

      // Assign impostors
      let available = [...Array(numPlayers).keys()];
      for(let k=0;k<numImpostors;k++){
        const pickIdx = randInt(available.length);
        const pidx = available.splice(pickIdx,1)[0];
        players[pidx].role = 'impostor';
      }

      // Assign words
      const word = defaultWords[randInt(defaultWords.length)];
      players.forEach(p=>{
        if(p.role === 'civil') p.word = word;
        else p.word = null; // impostor doesn't get the civilian word
      });

      // ready to pass
      namesSection.style.display = 'none';
      pass.style.display = 'block';
      discussion.style.display = 'none';
      results.style.display = 'none';

      revealIndex = 0;
      roleArea.style.display = 'none';
      nextBtn.style.display = 'none';
      updatePlayerIndicator();

      // Update reveal button text
      revealBtn.disabled = false;
      revealBtn.textContent = 'Ver mi rol';
    }

    function updatePlayerIndicator(){
      const currentPlayer = players[revealIndex];
      const isDefaultName = currentPlayer.name === `Jugador ${currentPlayer.id + 1}`;
      
      if(isDefaultName) {
        playerIndicator.textContent = `Jugador ${revealIndex + 1}`;
        playerNumber.textContent = `de ${numPlayers} jugadores`;
      } else {
        playerIndicator.textContent = currentPlayer.name;
        playerNumber.textContent = `Jugador ${revealIndex + 1} de ${numPlayers}`;
      }
    }

    function showRoleFor(index){
      const p = players[index];
      roleArea.innerHTML = '';
      roleArea.style.display = 'flex';

      if(p.role === 'impostor'){
        const b = document.createElement('div'); 
        b.className='impostor-badge'; 
        b.textContent='ü§´üî•¬°Eres el IMPOSTOR!üî•ü§´';
        b.style.marginTop = '-40px';
        roleArea.appendChild(b);
        
        const hint = document.createElement('div'); 
        hint.className='muted'; 
        hint.style.marginTop='4px'; 
        hint.textContent='Pasa desapercibido entre los civiles.'; 
        roleArea.appendChild(hint);
      } else {
        const b = document.createElement('div'); 
        b.className='civil-badge'; 
        b.textContent='‚úÖ Eres CIVIL ‚úÖ';
        roleArea.appendChild(b);
        
        const t = document.createElement('div'); 
        t.className='muted'; 
        t.style.fontSize='16px';
        t.style.marginTop='12px';
        t.textContent='La palabra es:'; 
        roleArea.appendChild(t);
        
        const w = document.createElement('div'); 
        w.className='word'; 
        w.textContent = p.word; 
        roleArea.appendChild(w);
      }

      nextBtn.style.display = 'inline-block';
      revealBtn.style.display = 'none';
      
      // Update button text based on if it's the last player
      if(revealIndex === players.length - 1) {
        nextBtn.textContent = '¬°Que empiece la partida!';
      } else {
        nextBtn.textContent = 'Siguiente';
      }
    }

    function showCountdown() {
      // Create countdown overlay with both: fullscreen black bg + centered in container
      const countdownScreen = document.createElement('div');
      countdownScreen.className = 'countdown-screen';
      document.body.appendChild(countdownScreen);
      
      // Create inner content container
      const innerContent = document.createElement('div');
      innerContent.style.cssText = 'position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-width:550px;width:90%;text-align:center;';
      countdownScreen.appendChild(innerContent);

      let count = 3;
      
      function displayNumber() {
        innerContent.innerHTML = `<div class="countdown-number">${count}</div>`;
        
        // Play sound based on count
        if(count === 3) playSound(600, 0.15, 0.25);
        else if(count === 2) playSound(750, 0.15, 0.25);
        else if(count === 1) playSound(900, 0.15, 0.25);
        
        count--;
        
        if(count >= 1) {
          setTimeout(displayNumber, 1000);
        } else {
          setTimeout(() => {
            innerContent.innerHTML = `<div class="countdown-number" style="font-size:50px;color:#ff3b3b">¬°A VOTAR!</div>`;
            playSound(1200, 0.3, 0.3);
            setTimeout(() => playSound(1400, 0.2, 0.25), 150);
            
            setTimeout(() => {
              countdownScreen.remove();
              discussion.style.display = 'block';
              
              // Choose random player to start talking
              const activePlayers = players.filter(p => !p.eliminated);
              const firstSpeaker = activePlayers[randInt(activePlayers.length)];
              const firstSpeakerElement = document.getElementById('firstSpeakerName');
              firstSpeakerElement.innerHTML = `üé§ Empieza hablando: <span style="font-size:28px;color:#ffffff;text-shadow:0 4px 14px rgba(255,255,255,0.8)">${firstSpeaker.name}</span>`;
              firstSpeakerElement.style.display = 'block';
              
              buildDiscussionVoteList();
            }, 1500);
          }, 1000);
        }
      }
      
      displayNumber();
    }

    function buildDiscussionVoteList(){
      discussionVoteList.innerHTML = '';
      players.filter(p => !p.eliminated).forEach(p=>{
        const el = document.createElement('div');
        el.className='player-pill';
        el.dataset.id = p.id;
        el.textContent = p.name;
        el.addEventListener('click', ()=>{
          playPopSound();
          // toggle selection
          if(el.classList.contains('selected')) el.classList.remove('selected');
          else el.classList.add('selected');
          // only one selected at a time
          Array.from(discussionVoteList.children).forEach(ch=>{ if(ch !== el) ch.classList.remove('selected') });
        });
        discussionVoteList.appendChild(el);
      });
    }

    submitGroupVoteBtn.addEventListener('click', ()=>{
      const sel = Array.from(discussionVoteList.children).find(c=>c.classList.contains('selected'));
      if(!sel){
        alert('Selecciona a alguien para expulsar.');
        return;
      }
      playSuccessSound();
      const votedId = parseInt(sel.dataset.id);
      showResults(votedId);
    });

    function showResults(executedId){
      const executedPlayer = players.find(p=>p.id===executedId);
      const isImpostor = executedPlayer.role === 'impostor';
      
      executedPlayer.eliminated = true;
      
      // Count remaining impostors
      const remainingImpostors = players.filter(p => p.role === 'impostor' && !p.eliminated).length;
      const totalImpostors = players.filter(p => p.role === 'impostor').length;
      
      // Get the word that was used
      const gameWord = players.find(p => p.role === 'civil')?.word || '';
      
      discussion.style.display = 'none';
      results.style.display = 'block';
      
      if(isImpostor) {
        if(remainingImpostors === 0) {
          // All impostors eliminated - Civilians win
          const impostorText = totalImpostors === 1 ? 'el impostor' : 'el √∫ltimo impostor';
          resultText.innerHTML = `<div style="font-size:24px;font-family:'Fredoka One',cursive;color:#4fd1c5">üéâ ¬°Los CIVILES ganan! üéâ</div>` +
            `<div style="margin-top:8px" class="muted">Hab√©is expulsado a <strong>${executedPlayer.name}</strong>, ${impostorText}.</div>` +
            `<div style="margin-top:16px;font-size:18px;color:#d0d3e1">La palabra era: <span style="font-size:32px;color:#4fd1c5;font-family:'Fredoka One',cursive;text-shadow:0 3px 10px rgba(79,209,197,0.6)">${gameWord}</span></div>`;
          newGameContainer.style.display = 'block';
        } else {
          // Still impostors remaining
          resultText.innerHTML = `<div style="font-size:22px;font-family:'Fredoka One',cursive;color:#ffc107">‚ö†Ô∏è Era un impostor!</div>` +
            `<div style="margin-top:8px" class="muted">Hab√©is expulsado a <strong>${executedPlayer.name}</strong>, pero quedan ${remainingImpostors} impostor${remainingImpostors>1?'es':''} m√°s.</div>` +
            `<div style="margin-top:12px"><button class="btn medium" id="continueGameBtn">Continuar partida</button></div>`;
          newGameContainer.style.display = 'none';
          
          setTimeout(() => {
            document.getElementById('continueGameBtn').addEventListener('click', () => {
              playClickSound();
              results.style.display = 'none';
              discussion.style.display = 'block';
              buildDiscussionVoteList();
            });
          }, 100);
        }
      } else {
        // Civilian eliminated - Game over, impostors win
        resultText.innerHTML = `<div style="font-size:24px;font-family:'Fredoka One',cursive;color:#ff3b3b">üíÄ ¬°Los IMPOSTORES ganan! üíÄ</div>` +
          `<div style="margin-top:8px" class="muted">Hab√©is expulsado a <strong>${executedPlayer.name}</strong>, que era un civil.</div>` +
          `<div style="margin-top:16px;font-size:18px;color:#d0d3e1">La palabra era: <span style="font-size:32px;color:#4fd1c5;font-family:'Fredoka One',cursive;text-shadow:0 3px 10px rgba(79,209,197,0.6)">${gameWord}</span></div>`;
        newGameContainer.style.display = 'block';
      }

      // reveal who were the impostors (only at game end)
      if(remainingImpostors === 0 || !isImpostor) {
        const impostorNames = players.filter(p=>p.role==='impostor').map(p=>p.name);
        const impostorText = impostorNames.map(name => `<span class="impostor-reveal">${name}</span>`).join('');
        impostorsReveal.innerHTML = `<div style="margin-bottom:8px;font-size:14px">Impostor${impostorNames.length>1?'es':''} ${impostorNames.length>1?'eran':'era'}:</div>` + impostorText;
      } else {
        impostorsReveal.innerHTML = '';
      }
    }

    newGame.addEventListener('click', ()=>{
      playClickSound();
      // reset votes and roles but keep player configuration
      players = [];
      setup.style.display = 'block';
      namesSection.style.display = 'none';
      pass.style.display = 'none';
      discussion.style.display = 'none';
      results.style.display = 'none';
      
      // Keep the current number of players and impostors
      playersDisplay.textContent = numPlayers;
      impostorsDisplay.textContent = numImpostors;
    });

    // --- INTRO HANDLER ---
    // IMPORTANTE: definir ANTES de usar en window.load
    function handleContinueFromIntro(){
      const introScreen = document.getElementById('introScreen');
      const mainContainer = document.getElementById('mainContainer');

      if(introScreen){
        introScreen.classList.add('fade-out');
        mainContainer.style.transition = 'opacity 0.5s ease-in';
        mainContainer.style.opacity = '1';
        setTimeout(() => {
          introScreen.remove();
        }, 500);
      } else {
        mainContainer.style.opacity = '1';
      }

      // Mostrar solo SETUP (selector de jugadores/impostores)
      setup.style.display = 'block';
      namesSection.style.display = 'none';
      pass.style.display = 'none';
      discussion.style.display = 'none';
      results.style.display = 'none';
    }

    // Botones
    continueBtn.addEventListener('click', ()=>{
      playSuccessSound();
      showNamesScreen();
    });

    startBtn.addEventListener('click', ()=>{
      unlockAudioWithUserGesture();
      playStartGameSound();
      startGame();
    });

    revealBtn.addEventListener('click', ()=>{
      unlockAudioWithUserGesture();
      playPopSound();
      showRoleFor(revealIndex);
    });

    nextBtn.addEventListener('click', ()=>{
      playClickSound();
      // hide role and move on
      roleArea.style.display = 'none';
      revealBtn.style.display = 'inline-block';
      nextBtn.style.display = 'none';
      revealBtn.disabled = false;

      revealIndex++;
      if(revealIndex < players.length){
        updatePlayerIndicator();
      } else {
        // all seen - show countdown before discussion
        pass.style.display = 'none';
        showCountdown();
      }
    });

    submitGroupVoteBtn.addEventListener('click', ()=>{
      const sel = Array.from(discussionVoteList.children).find(c=>c.classList.contains('selected'));
      if(!sel){
        alert('Selecciona a alguien para expulsar.');
        return;
      }
      playSuccessSound();
      const votedId = parseInt(sel.dataset.id);
      showResults(votedId);
    });

    // Intro: a los 3s se lanza autom√°ticamente handleContinueFromIntro()
    // PONER ESTE LISTENER AL FINAL DEL SCRIPT
    window.addEventListener('load', () => {
      setTimeout(() => {
        const introScreen = document.getElementById('introScreen');
        const mainContainer = document.getElementById('mainContainer');
        if(introScreen){
          handleContinueFromIntro();
        } else if(mainContainer && mainContainer.style.opacity === '0'){
          mainContainer.style.opacity = '1';
        }
      }, 3000);
    });
  </script>
</body>
</html>
